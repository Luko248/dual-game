/**
 * CYBERPUNK CSS-ONLY PARALLAX — CSS WRAPPED 2025
 *
 * Features used from css-first skill:
 *
 *  LAYOUT:        CSS nesting, :has(), logical properties, subgrid, isolation
 *  RESPONSIVE:    Range syntax media queries, @supports, dvh/svh/lvh units
 *  CONTAINER:     Size queries (cards), style queries (:has toggle)
 *  ANIMATION:     Scroll-driven (progress bar, card reveal, finale),
 *                 @starting-style (hero entry), view-transitions (@view-transition)
 *  THEMING:       light-dark(), color-scheme
 *  POSITIONING:   Anchor positioning (tooltip on card)
 *  INTERACTION:   Popover (tooltip), overscroll-behavior, :has() toggle,
 *                 :focus-within, hover media query
 *  VISUAL:        oklch(), color-mix(), relative color syntax,
 *                 backdrop-filter, clip-path, mix-blend-mode
 *  FUNCTIONS:     @property, trigonometric (sin/cos orbits)
 *  SPECIFICITY:   @layer, @scope
 *
 * Parallax: perspective on scroll container + translateZ on layers
 *           with transform-style: preserve-3d on sections
 */


/* ═══════════════════════════════════════════════════════
   @LAYER — cascade layer ordering (specificity control)
   ═══════════════════════════════════════════════════════ */

@layer reset, base, layout, components, effects, utilities;


/* ═══════════════════════════════════════════════════════
   @PROPERTY — typed custom properties for animation
   ═══════════════════════════════════════════════════════ */

@property --hue-rotate {
  syntax: "<angle>";
  inherits: false;
  initial-value: 0deg;
}

@property --glow {
  syntax: "<number>";
  inherits: false;
  initial-value: 0;
}

@property --progress {
  syntax: "<percentage>";
  inherits: false;
  initial-value: 0%;
}


/* ═══════════════════════════════════════════════════════
   RESET LAYER
   ═══════════════════════════════════════════════════════ */

@layer reset {
  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
}


/* ═══════════════════════════════════════════════════════
   BASE LAYER — tokens, body, typography
   ═══════════════════════════════════════════════════════ */

@layer base {
  :root {
    /* oklch() neon palette — perceptually uniform */
    --cyan: oklch(0.75 0.18 195);
    --magenta: oklch(0.65 0.25 330);
    --yellow: oklch(0.85 0.2 90);
    --green: oklch(0.72 0.2 145);
    --purple: oklch(0.55 0.25 290);
    --red: oklch(0.6 0.22 25);
    --dark: oklch(0.1 0.02 270);
    --darker: oklch(0.05 0.02 270);

    /* color-mix() — derived tokens */
    --cyan-dim: color-mix(in oklch, var(--cyan) 40%, transparent);
    --magenta-dim: color-mix(in oklch, var(--magenta) 40%, transparent);
    --green-dim: color-mix(in oklch, var(--green) 30%, transparent);

    /* relative color syntax — shift hue for variants */
    --cyan-warm: oklch(from var(--cyan) l c calc(h + 30));
    --magenta-cool: oklch(from var(--magenta) l c calc(h - 30));

    /* light-dark() — works with color-scheme */
    --surface: light-dark(oklch(0.95 0.01 270), var(--darker));
    --text: light-dark(oklch(0.2 0.02 270), var(--cyan));

    --font-mono: "SF Mono", "Fira Code", "Cascadia Code", monospace;
    --font-display: "Orbitron", system-ui, sans-serif;

    color-scheme: dark;

    /* interpolate-size for animating to auto */
    interpolate-size: allow-keywords;
  }

  body {
    background: var(--surface);
    color: var(--text);
    font-family: var(--font-mono);
    overflow: hidden;
    /* overscroll-behavior — prevent scroll chaining */
    overscroll-behavior: none;
  }
}


/* ═══════════════════════════════════════════════════════
   LAYOUT LAYER — parallax system, grid, logical props
   ═══════════════════════════════════════════════════════ */

@layer layout {

  /* ── Parallax scroll container ────────────────────── */
  .parallax {
    block-size: 100dvh; /* modern viewport unit */
    overflow-x: hidden;
    overflow-y: auto;
    perspective: 1px;
    perspective-origin: center center;
    overscroll-behavior-block: contain;

    /* Custom scrollbar */
    &::-webkit-scrollbar {
      inline-size: 4px;
    }

    &::-webkit-scrollbar-track {
      background: var(--darker);
    }

    &::-webkit-scrollbar-thumb {
      background: var(--magenta);
    }
  }

  /* ── Section — each parallax scene ────────────────── */
  .section {
    position: relative;
    min-block-size: 100dvh;
    /* CRITICAL for parallax — preserves 3D for children */
    transform-style: preserve-3d;
    display: grid;
    place-items: center;
    z-index: 1;
  }

  /* ── Layer depth system ───────────────────────────── */
  .layer {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
    overflow: hidden;
  }

  /* Deep: moves slow (far away) — scale compensates for translateZ shrink */
  .layer--deep {
    transform: translateZ(-2px) scale(3);
    z-index: 1;
  }

  /* Mid: moves medium speed */
  .layer--mid {
    transform: translateZ(-1px) scale(2);
    z-index: 2;
  }

  /* Front: moves with scroll (normal) */
  .layer--front {
    transform: translateZ(0);
    z-index: 3;
  }
}


/* ═══════════════════════════════════════════════════════
   COMPONENTS LAYER
   ═══════════════════════════════════════════════════════ */

@layer components {

  /* ── Scroll progress bar — scroll-driven animation ── */
  .progress-bar {
    position: fixed;
    inset-block-start: 0;
    inset-inline-start: 0;
    inset-inline-end: 0;
    block-size: 3px;
    background: linear-gradient(90deg, var(--cyan), var(--magenta), var(--yellow));
    transform-origin: inline-start;
    scale: 0 1;
    z-index: 200;
    animation: grow-progress linear both;
    animation-timeline: scroll(root);
  }

  @keyframes grow-progress {
    to {
      scale: 1 1;
    }
  }


  /* ── Sticky nav ──────────────────────────────────── */
  .nav {
    position: fixed;
    inset-block-start: 1rem;
    inset-inline: 0;
    z-index: 150;
    display: flex;
    justify-content: center;
    gap: 1rem;
    /* Popover attribute removes from normal flow */
    margin: 0;
    border: none;
    background: transparent;
    padding: 0;
  }

  .nav-link {
    font-family: var(--font-display);
    font-size: clamp(0.55rem, 1vw, 0.7rem);
    color: var(--cyan-dim);
    text-decoration: none;
    letter-spacing: 0.15em;
    padding: 0.4rem 0.8rem;
    border: 1px solid transparent;
    transition: all 0.3s ease;

    /* CSS nesting + :hover + :focus-within */
    &:hover,
    &:focus-visible {
      color: var(--cyan);
      border-color: var(--cyan-dim);
      text-shadow: 0 0 8px var(--cyan-dim);
    }
  }


  /* ════════════════════════════════════════════════════
     HERO SECTION
     ════════════════════════════════════════════════════ */

  .section--hero {
    background: linear-gradient(
      180deg,
      var(--darker) 0%,
      oklch(0.12 0.05 270) 40%,
      oklch(0.08 0.1 300) 100%
    );
  }

  /* Retro perspective grid floor */
  .grid-floor {
    position: absolute;
    inset-block-end: 0;
    inline-size: 300%;
    block-size: 70%;
    background:
      repeating-linear-gradient(
        90deg,
        oklch(0.5 0.18 330 / 0.25) 0px,
        transparent 1px,
        transparent 100px
      ),
      repeating-linear-gradient(
        0deg,
        oklch(0.5 0.18 330 / 0.25) 0px,
        transparent 1px,
        transparent 100px
      );
    transform: perspective(300px) rotateX(50deg);
    transform-origin: center bottom;
    mask-image: linear-gradient(to top, black 20%, transparent 80%);
    animation: grid-scroll 3s linear infinite;
  }

  @keyframes grid-scroll {
    to {
      background-position: 0 100px;
    }
  }

  /* City skyline — buildings using sin()/cos() for variation */
  .city {
    position: absolute;
    inset: 0;
  }

  .building {
    --n: 15;
    --x: calc(var(--i) / var(--n) * 100%);
    /* sin() for pseudo-random height variation */
    --h: calc(30% + 40% * abs(sin(var(--i) * 2.4)));

    position: absolute;
    inset-block-end: 5%;
    inset-inline-start: var(--x);
    inline-size: clamp(25px, 4vw, 55px);
    block-size: var(--h);
    background: linear-gradient(180deg, oklch(0.18 0.04 270), oklch(0.06 0.02 270));
    border-block-start: 2px solid var(--cyan);
    box-shadow: 0 0 15px var(--cyan-dim);

    /* Windows via mask + repeating gradient */
    &::before {
      content: "";
      position: absolute;
      inset: 6px 3px;
      background: repeating-linear-gradient(
        180deg,
        oklch(0.65 0.12 90 / 0.5) 0px,
        oklch(0.65 0.12 90 / 0.5) 3px,
        transparent 3px,
        transparent 7px
      );
      mask-image: repeating-linear-gradient(
        90deg,
        black 0px,
        black 3px,
        transparent 3px,
        transparent 7px
      );
      animation: flicker 3s steps(2) infinite;
      animation-delay: calc(var(--i) * 0.2s);
    }

    /* Antenna on odd buildings — cos() for height */
    &:nth-child(odd)::after {
      content: "";
      position: absolute;
      inset-block-end: 100%;
      inset-inline-start: 50%;
      inline-size: 1px;
      block-size: calc(8px + 10px * abs(cos(var(--i) * 1.7)));
      background: var(--red);
      box-shadow: 0 0 6px var(--red);
      animation: antenna-pulse 2s ease-in-out infinite alternate;
      animation-delay: calc(var(--i) * 0.3s);
    }
  }

  @keyframes flicker {
    50% { opacity: 0.5; }
  }

  @keyframes antenna-pulse {
    to { opacity: 0.2; }
  }

  /* Hero content — @starting-style for entry animation */
  .hero-content {
    text-align: center;
    opacity: 1;
    translate: 0 0;
    transition: opacity 1s ease, translate 1s ease;

    @starting-style {
      opacity: 0;
      translate: 0 30px;
    }
  }

  .hero-pre {
    font-size: clamp(0.6rem, 1.5vw, 0.9rem);
    color: var(--green);
    letter-spacing: 0.4em;
    margin-block-end: 1rem;
  }

  .hero-sub {
    font-size: clamp(0.7rem, 1.8vw, 1rem);
    color: var(--magenta);
    letter-spacing: 0.5em;
    margin-block-start: 1rem;
  }

  .hero-hint {
    font-size: clamp(0.5rem, 1vw, 0.65rem);
    color: var(--cyan-dim);
    margin-block-start: 3rem;
    letter-spacing: 0.3em;
    animation: hint-pulse 2s ease-in-out infinite;
  }

  @keyframes hint-pulse {
    0%, 100% { opacity: 0.3; translate: 0 0; }
    50% { opacity: 0.8; translate: 0 5px; }
  }


  /* ── Glitch text ─────────────────────────────────── */
  .glitch {
    font-family: var(--font-display);
    font-size: clamp(2.5rem, 8vw, 7rem);
    font-weight: 900;
    text-transform: uppercase;
    color: white;
    position: relative;
    /* isolation — stacking context control */
    isolation: isolate;
    text-shadow:
      0 0 10px var(--cyan),
      0 0 40px var(--cyan-dim),
      0 0 80px oklch(0.5 0.15 195 / 0.2);

    &::before,
    &::after {
      content: attr(data-text);
      position: absolute;
      inset-block-start: 0;
      inset-inline-start: 0;
      inline-size: 100%;
      block-size: 100%;
      /* mix-blend-mode for visual FX */
      mix-blend-mode: screen;
    }

    &::before {
      color: var(--magenta);
      animation: glitch-1 3s infinite linear alternate-reverse;
      clip-path: inset(0 0 70% 0);
    }

    &::after {
      color: var(--cyan);
      animation: glitch-2 2s infinite linear alternate-reverse;
      clip-path: inset(70% 0 0 0);
    }
  }

  @keyframes glitch-1 {
    0%   { clip-path: inset(20% 0 60% 0); translate: -3px 0; }
    10%  { clip-path: inset(50% 0 20% 0); translate: 2px 0; }
    20%  { clip-path: inset(10% 0 70% 0); translate: -1px 0; }
    30%  { clip-path: inset(60% 0 10% 0); translate: 3px 0; }
    40%  { clip-path: inset(30% 0 40% 0); translate: -2px 0; }
    50%  { clip-path: inset(80% 0 5% 0); translate: 1px 0; }
    60%  { clip-path: inset(5% 0 80% 0); translate: -3px 0; }
    70%  { clip-path: inset(40% 0 30% 0); translate: 2px 0; }
    80%  { clip-path: inset(70% 0 15% 0); translate: -1px 0; }
    90%  { clip-path: inset(15% 0 55% 0); translate: 3px 0; }
    100% { clip-path: inset(45% 0 25% 0); translate: 0; }
  }

  @keyframes glitch-2 {
    0%   { clip-path: inset(65% 0 10% 0); translate: 3px 0; }
    10%  { clip-path: inset(15% 0 60% 0); translate: -2px 0; }
    20%  { clip-path: inset(75% 0 5% 0); translate: 1px 0; }
    30%  { clip-path: inset(25% 0 50% 0); translate: -3px 0; }
    40%  { clip-path: inset(55% 0 20% 0); translate: 2px 0; }
    50%  { clip-path: inset(5% 0 75% 0); translate: -1px 0; }
    60%  { clip-path: inset(85% 0 0% 0); translate: 3px 0; }
    70%  { clip-path: inset(35% 0 40% 0); translate: -2px 0; }
    80%  { clip-path: inset(0% 0 85% 0); translate: 1px 0; }
    90%  { clip-path: inset(50% 0 25% 0); translate: -3px 0; }
    100% { clip-path: inset(30% 0 45% 0); translate: 0; }
  }

  .blink {
    animation: blink 1s steps(1) infinite;
  }

  @keyframes blink {
    50% { opacity: 0; }
  }


  /* ════════════════════════════════════════════════════
     FEATURES SECTION — cards
     ════════════════════════════════════════════════════ */

  .section--features {
    background: linear-gradient(
      180deg,
      oklch(0.08 0.1 300) 0%,
      var(--darker) 20%,
      oklch(0.07 0.05 195) 100%
    );
    /* Extra block-size for scrolling through cards */
    min-block-size: 120dvh;
    padding-block: 8dvh;
  }

  /* Matrix rain in deep layer */
  .matrix-rain {
    position: absolute;
    inset: 0;

    & span {
      position: absolute;
      inset-block-start: -20%;
      inset-inline-start: calc(var(--col) * 8.3%);
      color: var(--green-dim);
      font-size: 0.7rem;
      writing-mode: vertical-rl;
      animation: rain-fall var(--speed) var(--delay) linear infinite;
    }
  }

  @keyframes rain-fall {
    to { translate: 0 140dvh; }
  }

  /* Cards grid — container query context */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(240px, 100%), 1fr));
    gap: 1.5rem;
    padding-inline: clamp(1rem, 5vw, 4rem);
    max-inline-size: 900px;
    /* container for size queries */
    container-type: inline-size;
    container-name: cards;
  }

  /* Container size query — 2 columns when wide enough */
  @container cards (inline-size > 500px) {
    .cards-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  /* Card component */
  .card {
    padding: 1.5rem;
    /* backdrop-filter for glassmorphism */
    background: oklch(0.1 0.02 270 / 0.7);
    backdrop-filter: blur(12px);
    border: 1px solid oklch(0.3 0.1 195 / 0.3);
    border-block-start: 2px solid var(--cyan);
    position: relative;
    transition: border-color 0.3s, box-shadow 0.3s, translate 0.3s;

    /* scroll-driven reveal animation */
    animation: card-reveal linear both;
    animation-timeline: view();
    animation-range: entry 0% entry 30%;

    /* Corner brackets */
    &::before,
    &::after {
      content: "";
      position: absolute;
      inline-size: 10px;
      block-size: 10px;
      border: 2px solid var(--magenta);
      transition: border-color 0.3s;
    }

    &::before {
      inset-block-start: -1px;
      inset-inline-end: -1px;
      border-block-end: none;
      border-inline-start: none;
    }

    &::after {
      inset-block-end: -1px;
      inset-inline-start: -1px;
      border-block-start: none;
      border-inline-end: none;
    }

    /* :has() — style card differently when it contains certain badges */
    &:has(.card-badge--blue) {
      border-block-start-color: oklch(0.6 0.2 250);
    }

    /* hover — @media (hover: hover) for touch safety */
    @media (hover: hover) {
      &:hover {
        border-color: var(--cyan);
        box-shadow:
          0 0 25px var(--cyan-dim),
          inset 0 0 25px oklch(0.4 0.1 195 / 0.1);
        translate: 0 -4px;

        &::before,
        &::after {
          border-color: var(--cyan);
        }
      }
    }
  }

  @keyframes card-reveal {
    from {
      opacity: 0;
      translate: 0 40px;
    }
    to {
      opacity: 1;
      translate: 0 0;
    }
  }

  .card-icon {
    font-size: 1.3rem;
    margin-block-end: 0.8rem;
    color: var(--magenta);
    text-shadow: 0 0 12px var(--magenta-dim);
    font-family: var(--font-mono);
  }

  .card-title {
    font-family: var(--font-display);
    font-size: clamp(0.7rem, 1.5vw, 0.9rem);
    color: white;
    margin-block-end: 0.4rem;
    text-shadow: 0 0 8px var(--cyan-dim);
  }

  .card-desc {
    font-size: clamp(0.6rem, 1.2vw, 0.72rem);
    line-height: 1.7;
    color: oklch(0.6 0.04 195);
  }

  .card-badge {
    display: inline-block;
    font-size: 0.5rem;
    letter-spacing: 0.1em;
    padding: 0.2rem 0.5rem;
    margin-block-start: 0.8rem;
    border: 1px solid;

    &.card-badge--green {
      color: var(--green);
      border-color: var(--green-dim);
    }

    &.card-badge--blue {
      color: oklch(0.65 0.18 250);
      border-color: oklch(0.5 0.15 250 / 0.4);
    }
  }

  .card-line {
    margin-block-start: 0.8rem;
    block-size: 1px;
    background: linear-gradient(90deg, var(--cyan), transparent);
    animation: line-scan 2.5s ease-in-out infinite;
  }

  @keyframes line-scan {
    0%, 100% { scale: 0 1; transform-origin: inline-start; }
    50% { scale: 1 1; }
  }

  /* Anchor positioning — tooltip on anchor card */
  #anchor-card {
    anchor-name: --anchor-card;
  }

  .anchor-tooltip {
    position: fixed;
    position-anchor: --anchor-card;
    inset-block-end: anchor(--anchor-card block-start);
    inset-inline-start: anchor(--anchor-card center);
    translate: -50% -8px;
    margin: 0;
    padding: 0.6rem 1rem;
    background: oklch(0.15 0.05 270 / 0.95);
    border: 1px solid var(--cyan);
    color: var(--cyan);
    font-size: 0.65rem;
    font-family: var(--font-mono);
    white-space: nowrap;
    z-index: 100;

    /* @starting-style for popover entry */
    opacity: 1;
    scale: 1;
    transition: opacity 0.2s, scale 0.2s, display 0.2s;
    transition-behavior: allow-discrete;

    @starting-style {
      opacity: 0;
      scale: 0.9;
    }

    &:not(:popover-open) {
      opacity: 0;
      scale: 0.9;
    }
  }


  /* ════════════════════════════════════════════════════
     TERMINAL SECTION
     ════════════════════════════════════════════════════ */

  .section--terminal {
    background: linear-gradient(
      180deg,
      oklch(0.07 0.05 195) 0%,
      oklch(0.05 0.06 270) 40%,
      oklch(0.08 0.08 330) 100%
    );
  }

  /* Hex grid background */
  .hex-grid {
    position: absolute;
    inset: 0;
  }

  .hex {
    --size: clamp(35px, 5vw, 55px);
    position: absolute;
    inset-inline-start: calc(var(--col) * var(--size) * 1.8 + mod(var(--row), 2) * var(--size) * 0.9);
    inset-block-start: calc(var(--row) * var(--size) * 1.6);
    inline-size: var(--size);
    block-size: var(--size);
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    background: oklch(0.15 0.08 290 / 0.15);
    animation: hex-breathe 5s ease-in-out infinite;
    animation-delay: calc((var(--row) * 5 + var(--col)) * 0.25s);
  }

  @keyframes hex-breathe {
    0%, 100% { opacity: 0.15; }
    50% { opacity: 0.45; background: oklch(0.2 0.12 290 / 0.25); }
  }

  /* Orbital rings — trigonometric functions sin()/cos() */
  .orbit-container {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
  }

  .orbit {
    position: absolute;
    border-radius: 50%;
    border: 1px solid;
    animation: orbit-spin linear infinite;

    &.orbit--1 {
      --radius: min(200px, 35vw);
      --dots: 6;
      inline-size: calc(var(--radius) * 2);
      block-size: calc(var(--radius) * 2);
      border-color: oklch(0.4 0.12 195 / 0.25);
      animation-duration: 25s;
    }

    &.orbit--2 {
      --radius: min(140px, 25vw);
      --dots: 4;
      inline-size: calc(var(--radius) * 2);
      block-size: calc(var(--radius) * 2);
      border-color: oklch(0.4 0.12 330 / 0.25);
      animation-duration: 18s;
      animation-direction: reverse;
      border-style: dashed;
    }

    &.orbit--3 {
      --radius: min(80px, 15vw);
      --dots: 8;
      inline-size: calc(var(--radius) * 2);
      block-size: calc(var(--radius) * 2);
      border-color: oklch(0.4 0.12 90 / 0.25);
      animation-duration: 12s;
      border-style: dotted;
    }
  }

  @keyframes orbit-spin {
    to { rotate: 360deg; }
  }

  /* Dots placed with sin()/cos() */
  .orbit-dot {
    --total: 6;
    --a: calc(var(--angle) / var(--total) * 6.2832); /* 2π */
    position: absolute;
    inset-block-start: calc(50% + sin(var(--a)) * 50% - 3px);
    inset-inline-start: calc(50% + cos(var(--a)) * 50% - 3px);
    inline-size: 6px;
    block-size: 6px;
    border-radius: 50%;
    background: var(--cyan);
    box-shadow: 0 0 8px var(--cyan);
    animation: dot-pulse 2s ease-in-out infinite;
    animation-delay: calc(var(--angle) * 0.3s);
  }

  .orbit--2 .orbit-dot { --total: 4; background: var(--magenta); box-shadow: 0 0 8px var(--magenta); }
  .orbit--3 .orbit-dot { --total: 8; background: var(--yellow); box-shadow: 0 0 8px var(--yellow); }

  @keyframes dot-pulse {
    0%, 100% { scale: 1; opacity: 0.6; }
    50% { scale: 1.8; opacity: 1; }
  }

  /* Terminal window */
  .terminal-wrapper {
    /* scroll-driven reveal */
    animation: terminal-reveal linear both;
    animation-timeline: view();
    animation-range: entry 0% entry 40%;
  }

  @keyframes terminal-reveal {
    from { opacity: 0; scale: 0.85; }
    to { opacity: 1; scale: 1; }
  }

  .terminal {
    inline-size: clamp(300px, 55vw, 520px);
    background: oklch(0.07 0.02 270 / 0.92);
    border: 1px solid oklch(0.3 0.1 145 / 0.4);
    border-radius: 6px;
    overflow: hidden;
    /* backdrop-filter for glass */
    backdrop-filter: blur(16px);
    box-shadow:
      0 0 40px oklch(0.4 0.12 145 / 0.15),
      0 25px 80px oklch(0 0 0 / 0.6);
  }

  .terminal-bar {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 14px;
    background: oklch(0.12 0.02 270);
    border-block-end: 1px solid oklch(0.2 0.04 270);
  }

  .dot {
    inline-size: 10px;
    block-size: 10px;
    border-radius: 50%;

    &.dot--r { background: var(--red); }
    &.dot--y { background: var(--yellow); }
    &.dot--g { background: var(--green); }
  }

  .terminal-title {
    margin-inline-start: auto;
    font-size: 0.6rem;
    color: oklch(0.45 0.04 270);
    letter-spacing: 0.12em;
  }

  .terminal-body {
    padding: 1rem 1.2rem;

    & p {
      font-size: clamp(0.6rem, 1.3vw, 0.75rem);
      line-height: 1.9;
      color: var(--green);
      opacity: 0;
      animation: term-line 0.3s ease forwards;

      &:nth-child(1) { animation-delay: 0.1s; }
      &:nth-child(2) { animation-delay: 0.3s; }
      &:nth-child(3) { animation-delay: 0.5s; }
      &:nth-child(4) { animation-delay: 0.7s; }
      &:nth-child(5) { animation-delay: 0.9s; }
      &:nth-child(6) { animation-delay: 1.1s; }
      &:nth-child(7) { animation-delay: 1.3s; }
      &:nth-child(8) { animation-delay: 1.5s; }
      &:nth-child(9) { animation-delay: 1.7s; }
      &:nth-child(10) { animation-delay: 1.9s; }
      &:nth-child(11) { animation-delay: 2.1s; }
      &:nth-child(12) { animation-delay: 2.3s; }
    }
  }

  @keyframes term-line {
    to { opacity: 1; }
  }

  .prompt {
    color: var(--magenta);
    margin-inline-end: 0.5rem;
  }

  .val {
    color: var(--cyan);
    text-shadow: 0 0 6px var(--cyan-dim);
  }

  /* :has() live toggle — CSS-only interactive checkbox */
  .toggle-label {
    cursor: pointer;
    color: var(--green);
  }

  .toggle-check {
    appearance: none;
    inline-size: 0;
    block-size: 0;
    position: absolute;
  }

  .toggle-status {
    color: var(--yellow);
  }

  /* :has() — when checkbox is checked, style changes */
  .terminal:has(.toggle-check:checked) {
    border-color: var(--magenta);
    box-shadow:
      0 0 60px oklch(0.5 0.2 330 / 0.3),
      0 0 120px oklch(0.4 0.2 330 / 0.15),
      0 25px 80px oklch(0 0 0 / 0.6);

    & .toggle-status {
      color: var(--magenta);

      &::after {
        content: "ENGAGED";
      }
    }

    & .toggle-status {
      font-size: 0;
    }
  }

  .terminal:has(.toggle-check:checked) .toggle-status::after {
    font-size: clamp(0.6rem, 1.3vw, 0.75rem);
    color: var(--magenta);
    text-shadow: 0 0 10px var(--magenta);
  }

  /* @scope — scoped styles within terminal only */
  @scope (.terminal-body) {
    :scope p {
      border-inline-start: 2px solid transparent;
      padding-inline-start: 0.5rem;
      transition: border-color 0.2s;

      &:hover {
        border-inline-start-color: var(--cyan-dim);
      }
    }
  }


  /* ════════════════════════════════════════════════════
     FINALE SECTION
     ════════════════════════════════════════════════════ */

  .section--finale {
    background: linear-gradient(
      180deg,
      oklch(0.08 0.08 330) 0%,
      oklch(0.04 0.1 270) 40%,
      var(--darker) 100%
    );
  }

  /* Conic-gradient starburst */
  .starburst {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;

    &::before {
      content: "";
      inline-size: min(700px, 100vw);
      block-size: min(700px, 100vw);
      background: conic-gradient(
        from 0deg,
        oklch(0.25 0.12 195 / 0) 0deg,
        oklch(0.25 0.12 195 / 0.12) 8deg,
        oklch(0.25 0.12 195 / 0) 16deg,
        oklch(0.25 0.12 330 / 0) 16deg,
        oklch(0.25 0.12 330 / 0.12) 24deg,
        oklch(0.25 0.12 330 / 0) 32deg,
        oklch(0.25 0.12 90 / 0) 32deg,
        oklch(0.25 0.12 90 / 0.12) 40deg,
        oklch(0.25 0.12 90 / 0) 48deg
      );
      border-radius: 50%;
      /* @property animated rotation */
      animation: burst-spin 40s linear infinite;
    }
  }

  @keyframes burst-spin {
    to { rotate: 360deg; }
  }

  /* Particle field — trig positioning */
  .particle-field {
    position: absolute;
    inset: 0;
    display: grid;
    place-items: center;
  }

  .particle {
    --n: 12;
    --a: calc(var(--i) / var(--n) * 6.2832);
    --r: calc(120px + 80px * sin(var(--i) * 2.1));
    position: absolute;
    inset-block-start: calc(50% + sin(var(--a)) * var(--r));
    inset-inline-start: calc(50% + cos(var(--a)) * var(--r));
    inline-size: calc(3px + 3px * abs(sin(var(--i) * 1.5)));
    block-size: calc(3px + 3px * abs(sin(var(--i) * 1.5)));
    border-radius: 50%;
    background: oklch(0.7 0.15 calc(195 + var(--i) * 30));
    box-shadow: 0 0 6px oklch(0.5 0.15 calc(195 + var(--i) * 30));
    animation: particle-float 4s ease-in-out infinite alternate;
    animation-delay: calc(var(--i) * 0.35s);
  }

  @keyframes particle-float {
    to {
      translate: calc(sin(var(--i) * 3.7) * 20px) calc(cos(var(--i) * 2.3) * 20px);
      opacity: 0.3;
    }
  }

  /* Finale content — scroll-driven reveal */
  .finale-content {
    text-align: center;
    animation: finale-reveal linear both;
    animation-timeline: view();
    animation-range: entry 10% entry 45%;

    & .glitch {
      font-size: clamp(1.8rem, 6vw, 5rem);
    }
  }

  @keyframes finale-reveal {
    from { opacity: 0; translate: 0 40px; scale: 0.92; }
    to { opacity: 1; translate: 0 0; scale: 1; }
  }

  .finale-sub {
    font-size: clamp(0.55rem, 1.3vw, 0.8rem);
    color: oklch(0.55 0.08 195);
    letter-spacing: 0.2em;
    margin-block-start: 1.5rem;
    line-height: 2.2;
  }

  /* Feature counter */
  .feature-count {
    display: flex;
    justify-content: center;
    gap: clamp(1.5rem, 4vw, 3rem);
    margin-block-start: 2.5rem;
  }

  .count-item {
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
  }

  .count-num {
    font-family: var(--font-display);
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    font-weight: 900;
    color: white;
    text-shadow: 0 0 15px var(--cyan);
  }

  .count-label {
    font-size: clamp(0.45rem, 1vw, 0.6rem);
    color: var(--cyan-dim);
    letter-spacing: 0.2em;
  }

  /* CSS ONLY badge */
  .badge {
    display: inline-flex;
    margin-block-start: 2rem;
    border: 2px solid var(--magenta);
    font-family: var(--font-display);
    font-weight: 900;
    font-size: clamp(0.7rem, 1.8vw, 1rem);
    animation: badge-glow 2s ease-in-out infinite alternate;

    & span:first-child {
      padding: 0.5rem 1rem;
      background: var(--magenta);
      color: white;
    }

    & span:last-child {
      padding: 0.5rem 1rem;
      color: var(--magenta);
    }
  }

  @keyframes badge-glow {
    from {
      box-shadow:
        0 0 10px oklch(0.5 0.2 330 / 0.3),
        0 0 30px oklch(0.4 0.2 330 / 0.1);
    }
    to {
      box-shadow:
        0 0 25px oklch(0.5 0.2 330 / 0.5),
        0 0 70px oklch(0.4 0.2 330 / 0.25),
        0 0 120px oklch(0.3 0.2 330 / 0.1);
    }
  }
}


/* ═══════════════════════════════════════════════════════
   EFFECTS LAYER — scanlines, global FX
   ═══════════════════════════════════════════════════════ */

@layer effects {

  /* CRT scanline overlay */
  .scanline {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 300;
    background: repeating-linear-gradient(
      180deg,
      oklch(0 0 0 / 0) 0px,
      oklch(0 0 0 / 0) 2px,
      oklch(0 0 0 / 0.06) 2px,
      oklch(0 0 0 / 0.06) 4px
    );
    /* mix-blend-mode for authentic CRT */
    mix-blend-mode: multiply;

    /* Vignette */
    &::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        ellipse at center,
        transparent 55%,
        oklch(0 0 0 / 0.5) 100%
      );
    }
  }
}


/* ═══════════════════════════════════════════════════════
   UTILITIES LAYER — @supports, responsive, reduced motion
   ═══════════════════════════════════════════════════════ */

@layer utilities {

  /* @supports — feature detection for scroll-driven */
  @supports not (animation-timeline: view()) {
    .card,
    .terminal-wrapper,
    .finale-content {
      opacity: 1;
      translate: 0;
      scale: 1;
    }
  }

  /* @supports — feature detection for anchor positioning */
  @supports not (anchor-name: --x) {
    .anchor-tooltip {
      display: none;
    }
  }

  /* Range syntax media query — responsive */
  @media (width < 600px) {
    .cards-grid {
      grid-template-columns: 1fr;
      max-inline-size: 340px;
    }

    .building {
      inline-size: clamp(12px, 3vw, 25px);
    }

    .nav {
      gap: 0.4rem;
    }

    .feature-count {
      gap: 1rem;
    }
  }

  /* Large screens */
  @media (width >= 1200px) {
    .cards-grid {
      max-inline-size: 1100px;
    }
  }

  /* Reduced motion — accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* hover media query — disable hover effects on touch */
  @media (hover: none) {
    .card:hover {
      translate: 0;
      box-shadow: none;
    }
  }
}
